# CSRF和XSS

## CSRF(跨站请求伪造)

### 概念

是一种劫持受信任用户向服务器发送非预期请求的攻击方式，通常情况下，它是**攻击者借助受害者的 Cookie 骗取服务器的信任**，但是它并不能拿到Cookie，也看不到Cookie的内容，它能做的就是给服务器发送请求，然后执行请求中所描述的命令，以此来改变服务器中的数据，也就是并不能窃取服务器中的数据。

### 防御措施

- 验证`token`：浏览器请求服务器时，服务器返回一个token，每个请求都需要同时带上token和cookie才会被认为是合法请求
- 验证`Referer`：通过验证请求头的Referer来验证来源站点，但请求头很容易伪造
- 设置`SameSite`：设置cookie的SameSite，可以让cookie不随跨站请求发出，但浏览器兼容不一

## XSS(跨站脚本攻击)

### 概念

指的是**攻击者向网页注入恶意的客户端代码，通过恶意的脚本对客户端网页进行篡改，从而在用户浏览网页时，对用户浏览器进行控制或者获取用户隐私数据**的一种攻击方式。

### 类型

- **存储型**：即攻击被存储在服务端，常见的是在评论区插入攻击脚本，如果脚本被储存到服务端，那么所有看见对应评论的用户都会受到攻击。

- **反射型**：攻击者将脚本混在URL里，服务端接收到URL将恶意代码当做参数取出并拼接在HTML里返回，浏览器解析此HTML后即执行恶意代码

- **DOM型**：将攻击脚本写在URL中，诱导用户点击该URL，如果URL被解析，那么攻击脚本就会被运行。和前两者的差别主要在于DOM型攻击不经过服务端

### 防御措施

- **输入检查**：对输入内容中的`script`和`<iframe>`等标签进行转义或者过滤
- **设置httpOnly**：很多XSS攻击目标都是窃取用户cookie伪造身份认证，设置此属性可防止JS获取cookie
- **开启CSP**，即开启白名单，可阻止白名单以外的资源加载和运行