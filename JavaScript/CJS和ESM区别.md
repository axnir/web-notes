# CommonJS和ES6 Module

### 1. 主要区别

1. CommonJS 模块输出的是一个**值的拷贝**(浅拷贝)，ES6 模块输出的是**值的引用**

   - `CommonJS` 输出的是一个值的拷贝(注意基本数据类型/复杂数据类型)。

   - ES6 模块是动态引用，并且不会缓存值，模块里面的变量绑定其所在的模块。

2. CommonJS 模块是**运行时加载**，ES6 模块是**编译时输出接口**
   - ES6模块在编译时，就能确定模块的依赖关系，以及输入和输出的变量。ES6 模块不是对象，它的对外接口只是一种静态定义，在代码静态解析阶段就会生成。
   - `CommonJS` 加载的是一个对象，该对象只有在脚本运行完才会生成。

3. CommonJS 模块的`require()`是**同步**加载模块，ES6 模块的`import`命令是**异步**加载，有一个独立的模块依赖的解析阶段

### 2. 循环加载问题

1. CommonJS 模块的循环加载问题

   CommonJS 模块的重要特性是加载时执行，即脚本代码在`require`的时候，就会全部执行。一旦出现某个模块被"循环加载"，就**只输出已经执行的部分，还未执行的部分不会输出**。

2. ES6 Module 循环加载问题

   ES6 处理“循环加载”与 CommonJS 有本质的不同。ES6 模块是**动态引用**，如果使用`import`从一个模块加载变量（即`import foo from 'foo'`），那些变量不会被缓存，而是成为一个指向被加载模块的引用，**只要两个模块之间存在某个引用，代码就能够执行**。但是需要开发者自己保证，真正取值的时候能够取到值。

