# 进程、线程、协程

## 概念

* **进程**：是并发执行的程序在执行过程中分配和管理资源的基本单位，是一个动态概念，竞争计算机系统资源的基本单位。
* **线程：** 是进程的一个执行单元，是进程调度实体。比进程更小的独立运行的基本单位。线程也被称为轻量级进程。
* **协程：** 是一种比线程更加轻量级的存在。一个线程也可以拥有多个协程。

## 进程和线程的区别

- **地址空间：** 线程共享本进程的地址空间，而进程之间是独立的地址空间。

- **资源：** 线程共享本进程的资源如内存、I/O、CPU等，不利于资源的管理和保护，而进程之间的资源是独立的，能很好的进行资源管理和保护。

- **健壮性：** 多进程要比多线程健壮，一个进程崩溃后，在保护模式下不会对其他进程产生影响，但是一个线程崩溃整个进程都死掉。

- **执行过程：** 每个独立的进程有一个程序运行的入口、顺序执行序列和程序入口，执行开销大。但是线程不能独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制，执行开销小。

- **可并发性：** 两者均可并发执行。

- **切换时：** 进程切换时，消耗的资源大，效率低。所以涉及到频繁的切换时，使用线程要好于进程。同样如果要求同时进行并且又要共享某些变量的并发操作，只能用线程不能用进程。

- **其他：** 线程是处理器调度的基本单位，但是进程不是。

## 协程和线程的区别

  协程避免了无意义的调度，由此可以提高性能，但程序员必须自己承担调度的责任。同时，协程也失去了标准线程使用多CPU的能力。

线程：

- 相对独立
- 有自己的上下文
- 切换受系统控制；

协程：

- 相对独立
- 有自己的上下文
- 切换由自己控制，由当前协程切换到其他协程由当前协程来控制。

## 进程的几种状态

- **就绪状态**：进程已获得除处理机以外的所需资源，等待分配处理机资源

- **运行状态**：占用处理机资源运行，处于此状态的进程数小于等于CPU数

- **阻塞状态**： 进程等待某种条件，在条件满足之前无法执行

进程三种状态间的**转换**：

  - (1) **就绪→执行**：处于就绪状态的进程，当进程调度程序为之分配了处理机后，该进程便由就绪状态转变成执行状态。
  - (2) 执行→就绪：处于执行状态的进程在其执行过程中，因分配给它的一个时间片已用完而不得不让出处理机，于是进程从执行状态转变成就绪状态。
  - (3) 执行→阻塞：正在执行的进程因等待某种事件发生而无法继续执行时，便从执行状态变成阻塞状态。
  - (4) 阻塞→就绪：处于阻塞状态的进程，若其等待的事件已经发生，于是进程由阻塞状态转变为就绪状态。

## 多进程与多线程

- 多进程：在同一个时间里，同一个计算机系统中如果允许两个或两个以上的进程处于运行状态。多进程带来的好处是明显的，比如你可以听歌的同时，打开编辑器敲代码，编辑器和听歌软件的进程之间丝毫不会相互干扰。
- 多线程：程序中包含多个执行流，即在一个程序中可以同时运行多个不同的线程来执行不同的任务，也就是说允许单个程序创建多个并行执行的线程来完成各自的任务。

以Chrome浏览器中为例，当你打开一个 Tab 页时，其实就是创建了一个进程，一个进程中可以有多个线程，比如渲染线程、JS 引擎线程、HTTP 请求线程等等。当你发起一个请求时，其实就是创建了一个线程，当请求结束后，该线程可能就会被销毁。