#  TCP 和 UDP

### TCP

> `TCP`（Transmission Control Protocol，传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。
>
> `TCP` 相对于 `UDP` 有 2 个特点：
>
> - 对于数据包的丢失，建立重传机制
> - `TCP` 引入数据包排序机制，用来保证把乱序的数据包组合成一个完整的文件
>
> 在一个 `TCP` 连接中，会有 3 个过程。

#### 三次握手过程

刚开始客户端处于 `Closed` 的状态，服务器处于 `Listen` 状态。

1. **客户端发送到服务器**。客户端发送 `SYN` 报文给服务器，并且指明客户端初始化序列号为 `ISN(c)`，即以 `SYN=1, seq=x` 的形式发送过去。此时客户端处于 `SYN_SEND` 状态。
2. **服务器发送给客户端**。服务器收到客户端的 `SYN` 和 `ISN(c)`，也发送一个 `SYN` 回去，同时设置 `ACK = ISN(c) + 1` 以及指明服务器初始化序列号为 `ISN(s)`，即以 `SYN=1, ACK=x+1， seq=y` 的形式发送给客户端。
3. **客户端发送到服务器**。客户端收到服务器发送的消息后，设置 `ACK = ISN(s) + 1`，将自身的 `ISN(c) + 1`，即以 `ACK=y+1, seq=x+1` 的形式发送给服务器。此时客户端处于 `ESTABLISHED` 阶段，服务器收到报文，也处于 `ESTABLISHED` 阶段，双方建立了连接。





##### TCP 对应的协议

1. **FTP**：定义了文件传输协议，数据使用20端口，控制使用21端口。
2. **Telnet**：一种用于远程登陆的端口，使用23端口，用户可以以自己的身份远程连接到计算机上，可提供基于DOS模式下的通信服务。
3. **SMTP**：邮件传送协议，用于发送邮件。服务器开放的是25号端口。
4. **POP3**：它是和SMTP对应，POP3用于接收邮件。POP3协议所用的是110端口。
5. **HTTP**：是从Web服务器传输超文本到本地浏览器的传送协议。默认端口80。

### UDP

> 户数据包协议（User Datagram Protocol），简称 `UDP`，是基于 `IP` 之上开发能和应用打交道的协议。
>
> `UDP` 中一个最重要的信息是端口号，端口号其实就是一个数字，每个想访问网络的程序都需要绑定一个端口号。
>
> 通过端口号 `UDP` 就能把指定的数据包发送给指定的程序了，所以通过 `IP` 地址信息把数据包发送给指定的电脑，而 `UDP` 通过端口号把数据包分发给正确的程序。
>
> `UDP` 传输缺陷：
>
> - 数据包在传输过程容易丢失
> - 大文件传输中，`UDP` 并不知道如何组成这些数据包，不知道如何还原成完整的文件。
>
> 虽说 `UDP` 不能保证数据可靠性，但是传输速度却非常快，所以 `UDP` 会应用在一些关注速度、但不那么严格要求数据完整性的领域，如在线视频、互动游戏等。







##### UDP 对应的协议

1. **DNS**：用于域名解析服务，将域名地址转换为IP地址。DNS用的是53号端口。
2. **SNMP**：简单网络管理协议，使用161号端口，是用来管理网络设备的。由于网络设备很多，无连接的服务就体现出其优势。
3. **TFTP**(Trival File Transfer Protocal)：简单文件传输协议，该协议在熟知端口69上使用UDP服务。
4. **DHCP**(Dynamic Host Configuration Protocol)：动态主机配置协议是一个局域网的网络协议， 主要有两个用途：给内部网络或网络服务供应商自动分配IP地址，给用户或者内部网络管理员作为对所有计算机作中央管理的手段。



###  TCP 和 UDP 区别

- `TCP` 是面向连接的，`UDP` 是无连接的即发送数据前不需要先建立链接。
- `TCP` 提供可靠的服务。也就是说，通过 `TCP` 连接传送的数据，无差错，不丢失，不重复，且按序到达；UDP尽最大努力交付，即不保证可靠交付。并且因为 `TCP` 可靠，面向连接，不会丢失数据因此适合大数据量的交换。
- `TCP` 是面向字节流，`UDP` 面向报文，并且网络出现拥塞不会使得发送速率降低（因此会出现丢包，对实时的应用比如 `IP` 电话和视频会议等）。
- `TCP` 只能是 1对1 的，`UDP` 支持 1对1、1对多、多对多。
- `TCP` 的首部较大为 `20` 字节，而 `UDP` 只有 `8` 字节。